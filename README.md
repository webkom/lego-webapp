# lego-webapp [![DroneCI](https://ci.abakus.no/api/badges/webkom/lego-webapp/status.svg?branch=master)](https://ci.abakus.no/webkom/lego-webapp)

> Next-gen frontend for abakus.no

## Getting Started

### Installing dependencies

```bash
$ yarn
```

### Starting the client

```bash
$ yarn start
```

Everything should be up and running on [localhost:3000](http://localhost:3000).

For instructions on how to run the backend, see
[webkom/lego](https://github.com/webkom/lego).

#### Running without a local backend

It is possible to run the frontend without running the backend, by using our staging environment:

```
$ yarn start:staging
```

## Server side rendering

In production we use server side rendering. Due to bad hot reloading, we don't use it by default in dev. The server side renderer can be started by running:

```bash
$ yarn build
$ yarn ssr # or yarn ssr:staging
```

### Environment Variables

- NODE_ENV
- API_URL
- WS_URL
- BASE_URL
- SEGMENT_WRITE_KEY
- CAPTCHA_KEY
- STRIPE_KEY
- RAVEN_DSN
- RELEASE
- ENVIRONMENT
- HOST
- PORT
- SERVER_RAVEN_DSN
- SSR_API_URL
- SSR_BASE_URL

## Documentation

For simple component documentation we use
[react-docgen](https://github.com/reactjs/react-docgen), with
[react-styleguidist](https://github.com/styleguidist/react-styleguidist) for
easy style guide generation.

Start dev server (with hot reload), and go to
[localhost:6060](http://localhost:6060/).

```bash
$ yarn styleguide
```

To build a static version of the documentation, run:

```bash
$ yarn styleguide:build
```

## Text Editor

[Atom](https://atom.io) with these plugins installed provides the best developer
experience:

```bash
$ apm install nuclide pigments linter-eslint linter-stylelint prettier-atom
```

## Prettier

We use [prettier](https://github.com/prettier/prettier) for JS auto-formatting.
When the code isn't formatted with the prettier version in `package.json`, the
tests will fail. We highly recommend using format on save via an editor plugin,
for example [prettier-atom](https://atom.io/packages/prettier-atom) and
[vim-prettier](https://github.com/prettier/vim-prettier).

You can also format the code via `yarn prettier`.

## Tests

Run all the tests and check for lint errors with the command:

```bash
$ yarn test
```

For development you can run the tests continuously by using:

```bash
$ yarn test:watch
```

A coverage report can be generated by running `yarn test -- --coverage`.

## Flow

[Flow](https://flowtype.org/) is gradually being introduced so we can reap the
benefits of static type checking.

Run `flow` in the project directory to check if everything is good.

## Linting

ESLint and Stylelint is used to maintain high code quality and a unified code
style. Please run them before committing code.

To run the linter, use:

```bash
$ yarn run lint

# or
$ yarn run lint:js
$ yarn run lint:css
$ yarn run lint:prettier
```

Some ESLint errors can be fixed by running

```bash
$ yarn lint:js -- --fix
```

Some formatting errors reported by prettier can be fixed by running

```bash
$ yarn prettier
```
