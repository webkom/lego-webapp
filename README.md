# lego-webapp [![DroneCI](https://ci.abakus.no/api/badges/webkom/lego-webapp/status.svg?branch=master)](https://ci.abakus.no/webkom/lego-webapp)

> Next-gen frontend for abakus.no

## Getting Started
```bash
$ brew install yarn flow
$ yarn
$ yarn start
```

Everything should be up and running on [localhost:3000](http://localhost:3000).

For instructions on how to run the backend, see
[webkom/lego](https://github.com/webkom/lego).

## Build for production
```bash
$ yarn run build
$ NODE_ENV=production node dist/server.js
```

### Environment Variables
* NODE_ENV
* API_URL
* WS_URL
* BASE_URL
* SEGMENT_WRITE_KEY
* CAPTCHA_KEY
* STRIPE_KEY
* RAVEN_DSN
* RELEASE
* ENVIRONMENT
* HOST
* PORT
* SERVER_RAVEN_DSN

## Documentation
For simple component documentation we use [react-docgen](https://github.com/reactjs/react-docgen), with [react-styleguidist](https://github.com/styleguidist/react-styleguidist) for easy style guide generation.

Start dev server (with hot reload), and go to [localhost:6060](http://localhost:6060/).
```bash
$ yarn styleguide
```

To build a static version of the documentation, run:
```bash
$ yarn styleguide:build
```


## Text Editor
[Atom](https://atom.io) with these plugins installed provides the best developer experience:
```bash
$ apm install nuclide pigments linter-eslint linter-stylelint prettier-atom
```

## Prettier
We use [prettier](https://github.com/prettier/prettier) for JS auto-formatting. When the code isn't formatted with the prettier version in `package.json`, the tests will fail. We highly recommend using format on save via an editor plugin, for example [prettier-atom](https://atom.io/packages/prettier-atom) and [vim-prettier](https://github.com/prettier/vim-prettier).

You can also format the code via `yarn run lint:js -- --fix`.

## Tests
Run all the tests and check for lint errors with the command:
```bash
$ yarn test
```

For development you can run the tests continuously by using:
```bash
$ yarn run test:watch
```

A coverage report can be generated by running `yarn test -- --coverage`.

## Flow
[Flow](https://flowtype.org/) is gradually being introduced so we can reap the benefits of static type checking.

Run `flow` in the project directory to check if everything is good.

## Linting
ESLint and Stylelint is used to maintain high code quality and a unified code style. Please run them before committing code.

To run the linter, use:
```bash
$ yarn run lint

# or
$ yarn run lint:js
$ yarn run lint:css
```

Some ESLint errors can be fixed by running
```bash
$ yarn run lint:js -- --fix
```
